(()=>{"use strict";let t={session_id:crypto.randomUUID(),actions:{}},n=!1;async function e(){const n={prompt:JSON.stringify(t,null,2)};await fetch("http://localhost:8888/text_json",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)}).then((t=>t.blob())).then((t=>{const n=window.URL.createObjectURL(t),e=document.createElement("a");e.href=n,e.download="manual.txt",document.body.appendChild(e),e.click(),e.remove()}))}function o(){n&&e(),n=!n}window.downloadLogs=function(){const n=new Blob([JSON.stringify(t,null,2)],{type:"application/json"}),e=URL.createObjectURL(n),o=document.createElement("a");o.href=e,o.download="session-log.json",o.click(),URL.revokeObjectURL(e)},window.sendLogs=e,window.startLoging=o,document.addEventListener("click",(e=>{if(!n)return null;const o=e.composedPath?.()||[],a=e.target;let i;for(let t=0;t<o.length;t++){let n=o[t];"BUTTON"===n.tagName&&(i=n.getAttribute("aria-lable")),"INPUT"===n.tagName&&(i=n.getAttribute("placeholder"))}console.log("Click:",{tag:a.tagName,id:a.id,class:a.className,text:a.innerText?.slice(0,100),path:o.map((t=>t.tagName)).join(" > "),hint:i}),t.actions[(new Date).toISOString()]={Click:{tag:a.tagName,id:a.id,class:a.className,text:a.innerText?.slice(0,100),path:o.map((t=>t.tagName)).join(" > "),hint:i}}}));const a=XMLHttpRequest.prototype.open,i=XMLHttpRequest.prototype.send;function d(t){return t?t.nodeType===Node.TEXT_NODE?{type:"text",content:t.textContent}:t.nodeType===Node.ELEMENT_NODE?{tag:t.tagName,id:t.id,class:t.className,attributes:[...t.attributes].map((t=>({name:t.name,value:t.value})))}:{type:"other",nodeType:t.nodeType}:null}XMLHttpRequest.prototype.open=function(t,e){return n?(this._url=e,this._method=t,a.apply(this,arguments)):a.apply(this,arguments)},XMLHttpRequest.prototype.send=function(e){return n?(console.log("XHR:",{url:this._url,method:this._method,body:e}),t.actions[(new Date).toISOString()]={XHR:{resource:this._url,method:this._method,body:e}},i.apply(this,arguments)):i.apply(this,arguments)},new MutationObserver((e=>{if(!n)return null;for(const n of e){const e={type:n.type,target:d(n.target),addedNodes:[...n.addedNodes].map(d),removedNodes:[...n.removedNodes].map(d),attributeName:n.attributeName,oldValue:n.oldValue},o=(new Date).toISOString();t.actions||(t.actions={}),t.actions[o]={DOMChanged:e},console.log("DOM changed:",e)}})).observe(document.body,{childList:!0,subtree:!0}),window.addEventListener("popstate",(()=>{console.log("Navigated to:",window.location.href)})),window.addEventListener("load",(()=>{console.log("Page loaded:",window.location.href)})),function(){const t=(t,n={},e=[])=>{const o=document.createElement(t);return Object.entries(n).forEach((([t,n])=>{"class"===t?o.className=n:"text"===t?o.textContent=n:t.startsWith("on")?o.addEventListener(t.slice(2).toLowerCase(),n):o.setAttribute(t,n)})),e.forEach((t=>o.appendChild(t))),o},n=()=>{(()=>{const t=document.createElement("style");t.innerHTML="\n    .flowconnect-toggle {\n      position: fixed;\n      bottom: 24px;\n      right: 24px;\n      width: 48px;\n      height: 48px;\n      border-radius: 9999px;\n      background: white;\n      border: 1px solid #d1d5db;\n      box-shadow: 0 4px 8px rgba(0,0,0,0.1);\n      display: flex;\n      align-items: center;\n      justify-content: center;\n      cursor: pointer;\n      z-index: 9999;\n    }\n    .flowconnect-menu {\n      position: fixed;\n      bottom: 80px;\n      right: 24px;\n      display: flex;\n      flex-direction: column;\n      gap: 8px;\n      z-index: 9999;\n    }\n    .flowconnect-btn {\n      border-radius: 9999px;\n      background: white;\n      color: #374151;\n      padding: 10px 16px;\n      font-size: 14px;\n      font-weight: 500;\n      border: 1px solid #d1d5db;\n      box-shadow: 0 3px 6px rgba(0,0,0,0.1);\n      cursor: pointer;\n      display: flex;\n      align-items: center;\n      gap: 6px;\n      transition: background 0.2s;\n    }\n    .flowconnect-btn:hover {\n      background: #f3f4f6;\n    }\n    .flowconnect-dialog {\n      position: fixed;\n      top: 50%;\n      left: 50%;\n      width: 360px;\n      background: white;\n      border-radius: 10px;\n      border: 1px solid #d1d5db;\n      box-shadow: 0 8px 24px rgba(0,0,0,0.15);\n      transform: translate(-50%, -50%);\n      padding: 24px;\n      z-index: 9999;\n    }\n    .flowconnect-dialog input {\n      width: 100%;\n      padding: 10px;\n      margin-top: 12px;\n      border: 1px solid #d1d5db;\n      border-radius: 6px;\n      font-size: 14px;\n    }\n    .flowconnect-indicator {\n      position: fixed;\n      top: 16px;\n      left: 50%;\n      transform: translateX(-50%);\n      background: white;\n      color: #1f2937;\n      border: 1px solid #d1d5db;\n      border-radius: 12px;\n      box-shadow: 0 4px 12px rgba(0,0,0,0.1);\n      width: 280px;\n      padding: 16px;\n      z-index: 9999;\n    }\n    .flowconnect-progress {\n      margin-top: 10px;\n      height: 6px;\n      background: #e5e7eb;\n      border-radius: 9999px;\n      overflow: hidden;\n    }\n    .flowconnect-progress-bar {\n      height: 100%;\n      width: 0%;\n      background: #ef4444;\n      transition: width 1s linear;\n    }\n    .flowconnect-stop-btn {\n      margin-top: 12px;\n      width: 100%;\n      background: #ef4444;\n      color: white;\n      font-weight: 500;\n      border: none;\n      padding: 8px;\n      border-radius: 8px;\n      cursor: pointer;\n    }\n  ",document.head.appendChild(t)})();const n=t("div",{class:"flowconnect-toggle"},[t("img",{src:"https://cdn.jsdelivr.net/gh/MykhailoShushmanStartupSoft/codia_sdk@master/images/b141ea3a-509d-46f2-a7ad-23234114b19c.png",width:24,height:24})]),e=t("div",{class:"flowconnect-menu",style:"display: none;"}),a=t("button",{class:"flowconnect-btn",onclick:()=>g()},[t("span",{text:"🎙️"}),t("span",{text:"Record Flow"})]),i=t("button",{class:"flowconnect-btn",onclick:()=>alert("Configure clicked")},[t("span",{text:"⚙️"}),t("span",{text:"Configure"})]),d=t("button",{class:"flowconnect-btn",onclick:()=>{e.remove(),n.remove(),s?.remove()}},[t("span",{text:"❌"}),t("span",{text:"Exit FlowConnect"})]);e.appendChild(a),e.appendChild(i),e.appendChild(d),document.body.appendChild(n),document.body.appendChild(e),n.addEventListener("click",(()=>{e.style.display="none"===e.style.display?"flex":"none"}));let r,s,c,l,p,u=0;const g=()=>{r=t("div",{class:"flowconnect-dialog"},[t("h3",{text:"Name Your Flow Recording"}),t("input",{id:"flow-name",placeholder:"e.g., Checkout Experience"}),t("div",{style:"margin-top: 16px; text-align: right;"},[t("button",{class:"flowconnect-btn",text:"Cancel",onclick:()=>r.remove()}),t("button",{class:"flowconnect-btn",text:"Start",style:"margin-left: 8px; background: #3b82f6; color: white;",onclick:()=>{const t=r.querySelector("#flow-name").value.trim();t&&(r.remove(),h(t),o())}})])]),document.body.appendChild(r)},h=n=>{u=0,c=t("span",{text:"00:00"}),l=t("div",{class:"flowconnect-progress-bar"}),s=t("div",{class:"flowconnect-indicator"},[t("div",{},[t("strong",{text:n}),t("span",{style:"float: right;"},[c])]),t("div",{class:"flowconnect-progress"},[l]),t("button",{class:"flowconnect-stop-btn",text:"Stop Recording",onclick:()=>m()})]),document.body.appendChild(s),p=setInterval((()=>{u++;const t=String(Math.floor(u/60)).padStart(2,"0"),n=String(u%60).padStart(2,"0");c.textContent=`${t}:${n}`,l.style.width=`${Math.min(u,100)}%`}),1e3)},m=()=>{clearInterval(p),s.remove(),o(),alert("Recording stopped.")}};(async()=>{try{const t=new URLSearchParams(window.location.search),n=t.get("user_id"),e=new URL(window.location.href);if(n){localStorage.setItem("user_id",n),t.delete("user_id");const o=`${e.origin}${e.pathname}${t.toString()?"?"+t.toString():""}${e.hash}`;window.location.replace(o)}const o=document.currentScript,a=new URL(o.src),i=new URLSearchParams(a.search).get("uuid");if(console.log("user_id: "+n+" uuid: "+i),!localStorage.getItem("user_id")||!i)return console.warn("Missing user_id or uuid"),!1;const d=await fetch("http://codia-api.startupsoft.org:8888/api/customers/sdk/check-session/",{method:"POST",headers:{accept:"application/json","Content-Type":"application/json"},body:JSON.stringify({uuid:i,customer_id:localStorage.getItem("user_id")})}),r=await d.json();return console.log(r.is_active),!0===r.is_active}catch(t){return console.error("Error in check_user:",t),!1}})().then((t=>{t&&("loading"===document.readyState?document.addEventListener("DOMContentLoaded",n):n())}))}()})();